<!-- Toolbar -->
<div class="table-toolbar">
  <div class="view-group">
    <div class="view-selector">Users <span class="caret-icon">▾</span></div>
  </div>
  <div class="search-box">
    <svg viewBox="0 0 24 24">
      <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none" />
      <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
    </svg>
    <input placeholder="Search..." />
  </div>
</div>

<!-- Loader overlay -->
<div *ngIf="loading()" class="loader-overlay">
  <div class="loader-card">
    <div class="spinner">
      <div class="ring"></div>
      <div class="ring"></div>
      <div class="ring"></div>
    </div>
    <div class="loader-text">Cargando usuarios...</div>
  </div>
</div>

<div *ngIf="error()" style="padding:0 22px 10px;font-size:13px;color:#b91c1c;">{{ error() }}</div>

<!-- Users table -->
<div class="data-table" *ngIf="!loading() && !error() && users().length">
  <div class="table-header users-columns">
    <div>ID</div>
    <div>Name</div>
    <div>Role</div>
    <div>Status</div>
    <div>Email</div>
    <div>Access</div>
    <div>Actions</div>
  </div>
  <div class="table-body">
    <div class="table-row users-columns" *ngFor="let u of users()">
      <div class="table-cell text-muted">{{ u.id }}</div>
      <div class="table-cell">{{ u.name }}</div>
      <div class="table-cell">{{ u.role }}</div>
      <div class="table-cell">{{ u.status }}</div>
      <div class="table-cell">{{ u.email }}</div>
      <div class="table-cell text-amount">{{ u.access }}</div>
      <div class="table-cell">
        <div class="row-actions">
          <div class="action-pill" title="Edit" (click)="openEditUser(u)">
            <img src="assets/flecha.png" alt="Editar" />
          </div>
          <div class="action-pill" title="Delete" (click)="deleteUser(u)">
            <img src="assets/papelera.png" alt="Eliminar" />
          </div>
          <div class="action-pill" title="Ban" (click)="banUser(u)">
            <img src="assets/deleteUser.png" alt="Banear" />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div *ngIf="!loading() && !error() && !users().length" style="padding:0 22px 10px;font-size:13px;color:#6b7280;">No hay usuarios.</div>

<!-- Pagination -->
<div class="pagination" *ngIf="users().length">
  <div class="pagination-button" title="Previous">
    <svg viewBox="0 0 24 24">
      <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
  </div>
  <div class="pagination-pages">
    <a class="is-active">1</a><a>2</a><a>3</a><span>…</span><a>9</a>
  </div>
  <div class="pagination-button" title="Next">
    <svg viewBox="0 0 24 24">
      <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal-backdrop" *ngIf="showEditUserModal()" (click)="closeEditUserModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <button class="modal-close" (click)="closeEditUserModal()">✕</button>
    </div>
    <div class="modal-body">
      <div *ngIf="editError()" style="color:#b91c1c;font-size:13px;margin-bottom:10px;">{{ editError() }}</div>
      <div *ngIf="savingEdit()" style="font-size:13px;color:#374151;margin-bottom:10px;">Guardando cambios...</div>
      <app-edit-usuario *ngIf="selectedUser()" [user]="selectedUser()!" (save)="onUserSave($event)" (cancelEdit)="closeEditUserModal()"></app-edit-usuario>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showDeleteConfirm()" (click)="cancelDelete()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <button class="modal-close" (click)="cancelDelete()">✕</button>
    </div>
    <div class="modal-body">
      <h3 style="margin:0 0 12px;font-size:18px;font-weight:600;">Confirmar eliminación</h3>
      <p style="margin:0 0 16px;font-size:14px;line-height:1.4;">¿Seguro que deseas eliminar al usuario <strong>{{ userToDelete()?.name }}</strong>? Esta acción no se puede deshacer.</p>
      <div *ngIf="deleteError()" style="color:#b91c1c;font-size:13px;margin-bottom:12px;">{{ deleteError() }}</div>
      <div style="display:flex;gap:10px;justify-content:flex-end;">
        <button (click)="cancelDelete()" [disabled]="deletingUser()" style="padding:8px 14px;border-radius:8px;border:1px solid #d1d5db;background:#fff;font-size:13px;cursor:pointer;">Cancelar</button>
        <button (click)="confirmDelete()" [disabled]="deletingUser()" style="padding:8px 14px;border-radius:8px;border:1px solid #dc2626;background:#dc2626;color:#fff;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px;">
          <span *ngIf="!deletingUser()">Eliminar</span>
          <span *ngIf="deletingUser()">Eliminando...</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Ban Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showBanConfirm()" (click)="cancelBan()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <button class="modal-close" (click)="cancelBan()">✕</button>
    </div>
    <div class="modal-body">
      <h3 style="margin:0 0 12px;font-size:18px;font-weight:600;">Confirmar baneo</h3>
      <p style="margin:0 0 16px;font-size:14px;line-height:1.4;">¿Seguro que deseas banear / desactivar al usuario <strong>{{ userToBan()?.name }}</strong>? Podrás desbanearlo desde la sección de usuarios baneados.</p>
      <div *ngIf="banError()" style="color:#b91c1c;font-size:13px;margin-bottom:12px;">{{ banError() }}</div>
      <div style="display:flex;gap:10px;justify-content:flex-end;">
        <button (click)="cancelBan()" [disabled]="banningUser()" style="padding:8px 14px;border-radius:8px;border:1px solid #d1d5db;background:#fff;font-size:13px;cursor:pointer;">Cancelar</button>
        <button (click)="confirmBan()" [disabled]="banningUser()" style="padding:8px 14px;border-radius:8px;border:1px solid #111827;background:#111827;color:#fff;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px;">
          <span *ngIf="!banningUser()">Banear</span>
          <span *ngIf="banningUser()">Baneando...</span>
        </button>
      </div>
    </div>
  </div>
</div>
